<%
if !defined?(name) || name== nil || name.empty?
  $model_name = 'mbzirc_quadrotor'
else
  $model_name = name
end
%>

<?xml version="1.0"?>
<sdf version='1.9'>
  <model name="<%= $model_name%>">

    <!-- Platform base model-->
    <include merge="true">
      <uri>model://mbzirc_fixed_wing_base</uri>
    </include>

    <!-- Joints -->
    <plugin
      filename="ignition-gazebo-joint-position-controller-system"
      name="ignition::gazebo::systems::JointPositionController">
      <joint_name>flap_left_joint</joint_name>
      <use_velocity_commands>true</use_velocity_commands>
      <topic>/model/<%= $model_name%>/joint/left_flap_joint/cmd_pos</topic>
    </plugin>
    <plugin
      filename="ignition-gazebo-joint-position-controller-system"
      name="ignition::gazebo::systems::JointPositionController">
      <joint_name>flap_right_joint</joint_name>
      <use_velocity_commands>true</use_velocity_commands>
      <topic>/model/<%= $model_name%>/joint/right_flap_joint/cmd_pos</topic>
    </plugin>
    <plugin
      filename="ignition-gazebo-joint-controller-system"
      name="ignition::gazebo::systems::JointController">
      <joint_name>propeller_joint</joint_name>
    </plugin>

    <!-- Battery plugin -->
    <!-- Since we are interested in using time as the limiting factor -->
    <plugin filename="libignition-gazebo-linearbatteryplugin-system.so"
      name="ignition::gazebo::systems::LinearBatteryPlugin">
      <battery_name>linear_battery</battery_name>
      <voltage>12.694</voltage>
      <open_circuit_voltage_constant_coef>12.694</open_circuit_voltage_constant_coef>
      <open_circuit_voltage_linear_coef>0</open_circuit_voltage_linear_coef>
      <initial_charge><%= capacity%></initial_charge>
      <capacity><%= capacity%></capacity>
      <resistance>0.061523</resistance>
      <smooth_current_tau>1.9499</smooth_current_tau>
      <power_load>6.6</power_load>
      <start_on_motion>true</start_on_motion>
      <fix_issue_225>true</fix_issue_225>
    </plugin>

    <plugin filename="libignition-gazebo-pose-publisher-system.so"
      name="ignition::gazebo::systems::PosePublisher">
      <publish_link_pose>true</publish_link_pose>
      <publish_sensor_pose>true</publish_sensor_pose>
      <publish_collision_pose>false</publish_collision_pose>
      <publish_visual_pose>false</publish_visual_pose>
      <publish_nested_model_pose>true</publish_nested_model_pose>
      <publish_model_pose>false</publish_model_pose>
      <use_pose_vector_msg>true</use_pose_vector_msg>
      <static_publisher>true</static_publisher>
      <static_update_frequency>1</static_update_frequency>
    </plugin>
  </model>
</sdf>
